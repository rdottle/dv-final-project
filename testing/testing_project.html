<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Cloropleth map</title>
  </head>

  <style type="text/css">
    /*CSS goes here */
  </style>
  
  <body>
    <!-- page elements go here -->
    <!-- side panel -->
    <div class="sidePanel">
      <div class = "container" >
        <div class="row">
          <div class="col-md-2">
            <!-- heading -->
            <h1> FILTER </h1>
            <!-- list of tags to select  -->
            <ul class="selections">
              <li class="topHeading">Price</li>
              <li><input name="updateButton" id="affordablefrequency" type="button" value="Affordable"></li>             
              <li><input name="updateButton" id="luxuryfrequency" type="button" value="Luxury"></li> 
            </ul>

            <ul class="selections">
              <li class="topHeading">Interior</li>
              <li><input name="updateButton" id="cozyfrequency" type="button" value="Cozy"></li> 
              <li><input name="updateButton" id="modernfrequency" type="button" value="Modern"></li>            
            </ul>

            <ul class="selections">
              <li class="topHeading">Identity</li>
              <li><input name="updateButton" id="diversefrequency" type="button" value="Diverse"></li> 
              <li><input name="updateButton" id="hipsterfrequency" type="button" value="Hipster"></li> 
              <li><input name="updateButton" id="historicfrequency" type="button" value="Historic"></li> 
            </ul>

            <ul class="selections">
              <li class="topHeading">Neighborhood Amenities</li>
              <li><input name="updateButton" id="barfrequency" type="button" value="Bar"></li> 
              <li><input name="updateButton" id="parkfrequency" type="button" value="Park"></li> 
            </ul>

            <ul class="selections">
              <li class="topHeading">Pace</li>
              <li><input name="updateButton" id="quietfrequency" type="button" value="Quiet"></li> 
              <li><input name="updateButton" id="busyfrequency" type="button" value="Busy"></li> 
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <div class="bodyPanel">
      <div class = "container" >
        <div class="row">
          <div class="col-md-10">
            <div class="chloroplethMap"> </div>
              <div class="source">
                <span class="sourceTitle"></span>
                <span class="sourceText"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </body>
<!--  links  to bootstrap and d3 and stylesheet-->
  <script src="http://d3js.org/d3.v4.min.js"></script>
  <script src="http://d3js.org/d3-queue.v3.min.js"></script>  
  <script src="http://d3js.org/topojson.v1.min.js"></script>    

  <!-- Stylesheet + Bootstrap link -->
  <!-- <link href="css/bootstrap.min.css" rel="stylesheet">  -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">  
  <link rel="stylesheet" type="text/css" href="testing_NTA.css">
  <link rel="stylesheet" type="text/css" href="../css/site-specific.css">

  <script type="text/javascript">

//map basics
  //Creates tooltip and makes it invisiblae
  var div = d3.select(".chloroplethMap").append("div")
    .attr("class", "tooltip")
    .style("opacity", 0);

  //using svg element to display the map on 
  var width = 970;
      height = 560;

  var projection = d3.geoMercator()
      .center([-73.94, 40.70]) //sets a single standard parallel at selected lat 
      .scale(50000) //obvi scale of the map 
      .translate([width / 2, height / 2]); //a pixel offset that's commonly specified to ensure that the center of the projection is in the center of the viewing area

  var path = d3.geoPath()
      .projection(projection);

  //sets/creates svg window  
  var svg = d3.select(".chloroplethMap").append("svg")
      .attr("width", width)
      .attr("height", height)

  //SETTING COLORS FOR THE LEGEND
  var legend_color_domain = [5, 10, 15, 20, 25] //LOWER LIMIT
  var legend_labels = ["1000", "5000", "30000", "60000", "80000"]  

  //setting colors - should it ramp from white or f4f4f8 to the actual color or how to do the actual colors it is ramping? 
  var color = d3.scaleLinear()
    .domain([0.000152036, 7.142857143])
    .range(["#f4f4f8","#f4f4f8"])
  //REVIEWS 
  var colorPriceAffordable = d3.scaleLinear()
    .domain([0, 0.407608696])
    .range(["#ffffff","#06063B"]) //super dark blue like almost black 
  var colorPriceLuxury = d3.scaleLinear()
    .domain([0, 0.201612903])
    .range(["#ffffff","#06063B"])

  var colorInteriorCozy = d3.scaleLinear()
    .domain([0, 1.52284264])
    .range(["#ffffff","#330003"]) //super dark red like almost black 
  var colorInteriorModern = d3.scaleLinear()
    .domain([0, 0.337837838])
    .range(["#ffffff","#330003"])

  var colorIdentityDiverse = d3.scaleLinear()
    .domain([0, 0.200722601])
    .range(["#ffffff","#100026"])
  var colorIdentityHipster = d3.scaleLinear()
    .domain([0, 0.10384216])
    .range(["#ffffff","#100026"])
  var colorIdentityHistoric = d3.scaleLinear()
    .domain([0, 0.063417728])
    .range(["#ffffff","#100026"])

  var colorAmenitiesBar = d3.scaleLinear()
    .domain([0, 5.555555556])
    .range(["#ffffff","#220024"])
  var colorAmenitiesPark = d3.scaleLinear()
    .domain([0, 2.030456853])
    .range(["#ffffff","#220024"])

  var colorPaceQuiet = d3.scaleLinear()
    .domain([0, 1.411290323])
    .range(["#ffffff","#570E0E"])
  var colorPaceBusy = d3.scaleLinear()
    .domain([0, 0.21905805])
    .range(["#ffffff","#570E0E"])

  d3.queue()  
      .defer(d3.json, "boroughs_NTA.json")
      .defer(d3.csv, "nta_updated_reviews_listings.csv") 
      .await(ready); //Run 'ready' when JSONs are loaded

//FREQS: affordable, barfreq, busyfreq, cozyfreq, diversefre, hipsterfre, historicfr, luxuryfreq, modernfreq, parkfreq, quietfreq
 //BASIC 
  function ready(error, nyc, frequency) { //error, var1, var2
    if (error) throw error;
    console.log(nyc)
    console.log(frequency)

    //reviews
    var affordableFreq = {};
    var barFreq = {};
    var busyFreq = {};
    var cozyFreq = {};
    var diverseFreq = {};
    var hipsterFreq = {};
    var historicFreq = {};
    var luxuryFreq = {};
    var modernFreq = {};
    var parkFreq = {};
    var quietFreq = {};
    //listings
    var affordableListFreq = {};
    var barListFreq = {};
    var busyListFreq = {};
    var cozyListFreq = {};
    var diverseListFreq = {};
    var hipsterListFreq = {};
    var historicListFreq = {};
    var luxuryListFreq = {};
    var modernListFreq = {};
    var parkListFreq = {};
    var quietListFreq = {};
 
    frequency.forEach(function(d) {
      //these are for reviews
      affordableFreq[d.ntacode] = +d.affordablefreq; 
      barFreq[d.ntacode] = +d.barfreq;
      busyFreq[d.ntacode] = +d.busyfreq;
      cozyFreq[d.ntacode] = +d.cozyfreq;
      diverseFreq[d.ntacode] = +d.diversefreq;
      hipsterFreq[d.ntacode] = +d.hipsterfreq;
      historicFreq[d.ntacode] = +d.historicfreq;
      luxuryFreq[d.ntacode] = +d.luxuryfreq;
      modernFreq[d.ntacode] = +d.modernfreq;
      parkFreq[d.ntacode] = +d.parkfreq;
      quietFreq[d.ntacode] = +d.quietfreq;
      //these are for listings
      affordableListFreq[d.ntacode] = +d.affordablelistfreq; 
      barListFreq[d.ntacode] = +d.barlistfreq;
      busyListFreq[d.ntacode] = +d.busylistfreq;
      cozyListFreq[d.ntacode] = +d.cozylistfreq;
      diverseListFreq[d.ntacode] = +d.diverselistfreq;
      hipsterListFreq[d.ntacode] = +d.hipsterlistfreq;
      historicListFreq[d.ntacode] = +d.historiclistfreq;
      luxuryListFreq[d.ntacode] = +d.luxurylistfreq;
      modernListFreq[d.ntacode] = +d.modernlistfreq;
      parkListFreq[d.ntacode] = +d.parklistfreq;
      quietListFreq[d.ntacode] = +d.quietlistfreq;
      // console.log(affordableFreq)
    });

    //here we are seperating the features so we can style them through svg.selectAll(".newclasswearemaking")
    svg.append("g")
        .attr("class", "nta") //i define the class 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) // Bind TopoJSON data elements - this has to be basically the name of the file under the objects in the json 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return color(affordableFreq[d.properties.ntacode]);
        })
        // .style("fill", "black")
        .style("stroke", "white")
        .style("stroke-width", "0.1")

// Add mouse events
    d3.select("#affordablefrequency").on("click", affordablefrequency);
      function affordablefrequency(d){
      svg.append("g")
        .attr("class", "nta") //i define the class 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) // Bind TopoJSON data elements - this has to be basically the name of the file under the objects in the json 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorPriceAffordable(affordableFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }
    d3.select("#luxuryfrequency").on("click", luxuryfrequency);
      function luxuryfrequency(d){
      svg.append("g")
        .attr("class", "nta") 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorPriceLuxury(luxuryFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }

    d3.select("#modernfrequency").on("click", modernfrequency);
      function modernfrequency(d){
      svg.append("g")
        .attr("class", "nta") 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorInteriorModern(modernFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }
    d3.select("#cozyfrequency").on("click", cozyfrequency);
      function cozyfrequency(d){
      svg.append("g")
        .attr("class", "nta") //i define the class 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorInteriorCozy(cozyFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }

      d3.select("#diversefrequency").on("click", diversefrequency);
      function diversefrequency(d){
      svg.append("g")
        .attr("class", "nta") 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorIdentityDiverse(diverseFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }
    d3.select("#hipsterfrequency").on("click", hipsterfrequency);
      function hipsterfrequency(d){
      svg.append("g")
        .attr("class", "nta") 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorIdentityHipster(hipsterFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }
    d3.select("#historicfrequency").on("click", historicfrequency);
      function historicfrequency(d){
      svg.append("g")
        .attr("class", "nta") 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorIdentityHistoric(historicFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }
    
    d3.select("#barfrequency").on("click", barfrequency);
      function barfrequency(d){
      svg.append("g")
        .attr("class", "nta") //i define the class 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) // Bind TopoJSON data elements - this has to be basically the name of the file under the objects in the json 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorAmenitiesBar(barFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }
    d3.select("#parkfrequency").on("click", parkfrequency);
      function parkfrequency(d){
      svg.append("g")
        .attr("class", "nta") 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorAmenitiesPark(parkFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }

    d3.select("#quietfrequency").on("click", quietfrequency);
      function quietfrequency(d){
      svg.append("g")
        .attr("class", "nta") 
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorPaceQuiet(quietFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }
    d3.select("#busyfrequency").on("click", busyfrequency);
      function busyfrequency(d){
      svg.append("g")
        .attr("class", "nta")  
      .selectAll("path")
        .data(topojson.feature(nyc, nyc.objects.NY_NTA).features) 
      .enter().append("path")
        .attr("d", path)
        .style("fill", function(d) {
          return colorPaceBusy(busyFreq[d.properties.ntacode]);
        })
        .style("stroke", "lightgrey")
        .style("stroke-width", "0.2")
      }
      
  //adding outline for borough boundaries 
   svg.append("path")
    .datum(topojson.mesh(nyc, nyc.objects.nybb))
    .attr("class", "boroughs") 
    .attr("d", path)
};

  //appends chart source text 
   d3.select(".sourceTitle")
    .text("SOURCE: ")
    .attr("class", "sourceTitle");

   d3.select(".sourceText")
    .text("Department of City Planning (2017), Inside AirBnB (2017)")
    .attr("class", "sourceText");

  //drawing legend for chloropleth
   var legend = svg.selectAll("g.legend")
    .data(legend_color_domain)
    .enter().append("g")
    .attr("class", "legend");

    var legendRectWidth = 20, legendRectHeight = 20; //width and height

    legend.append("rect") //legend boxes
    .attr("x", 20) //horizontal location
    .attr("y", function(d, i){ return height - (i*legendRectHeight) - 2*legendRectHeight;}) //vertical location
    .attr("width", legendRectWidth)
    .attr("height", legendRectHeight)
    .style("fill", function(d, i) { return color(d); })
    .style("opacity", 0.8);
    
    var legend_items = ["Low", "", "", "", "", "", "", "", "High"];
    legend.append("text") //legend text
    .attr("class", "legendText") //gives it class so can edit in css
    .attr("x", 50) //positioning
    .attr("y", function(d, i){ return height - (i*legendRectHeight) - legendRectHeight - 4;}) //multiplying by i puts all the boxes
    .text(function(d, i){ return legend_labels[i]; });

    legend.append("text")
    .attr("class", "legendHeading")
    .attr("x", 20)
    .attr("y", function(d){ return height - 6 - legendRectHeight * 6;}) //multiplying and subtractingincreases the height vertically
    .text("Relative Frequency")

  </script>   

</html>